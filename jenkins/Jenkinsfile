pipeline {
  agent { label 'slave' }

  options {
    timestamps()
  }

  parameters {
    string(name: 'DOCKERHUB_USERNAME', defaultValue: '', description: 'Docker Hub username')
    password(name: 'DOCKERHUB_PASSWORD', defaultValue: '', description: 'Docker Hub password or token')
  }

  stages {
    stage('Checkout') {
      steps {
        git branch: 'master',
            credentialsId: 'github',
            url: 'https://github.com/rozana10710/demo2-jenkins-ansbile-docker-webapp.git'
        sh 'git log -1 --oneline || true'
      }
    }

    stage('Build & Push with Ansible') {
      steps {
        withEnv([
          "DOCKERHUB_USERNAME=${params.DOCKERHUB_USERNAME}",
          "DOCKERHUB_PASSWORD=${params.DOCKERHUB_PASSWORD}"
        ]) {
          sh 'ansible-playbook ansbile/main_playbook.yaml'
        }
      }
    }
  }
}
